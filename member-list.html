<!DOCTYPE html>
<html class="x-admin-sm">

<head>
  <meta charset="UTF-8">
  <title>欢迎页面-X-admin2.2</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport"
    content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
  <link rel="stylesheet" href="./css/font.css">
  <link rel="stylesheet" href="./css/xadmin.css">
  <script src="./lib/layui/layui.js" charset="utf-8"></script>
  <script type="text/javascript" src="./js/xadmin.js"></script>
  <!--[if lt IE 9]>
          <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
          <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
  <style>
    .page-bar {
      margin: 40px;
      transform: translateY(50%);
      /**上移元素**/
      -ms-transform: translateY(-50%);
      -webkit-transform: translateY(-50%);

    }

    ul,
    li {
      margin: 0px;
      padding: 0px;
      top: 20px;
    }

    li {
      list-style: none
    }

    .page-bar li:first-child>a {
      margin-left: 800px;
      top: -20px;

    }

    .page-bar a {
      border: 1px solid #ddd;
      text-decoration: none;
      position: relative;
      float: left;
      padding: 6px 12px;
      margin-left: -1px;
      line-height: 1.42857143;
      color: #337ab7;
      cursor: pointer;

      top: -20px;
    }

    .page-bar a:hover {
      background-color: #eee;
    }

    .page-bar a.banclick {
      cursor: not-allowed;
    }

    .page-bar .active a {
      color: #fff;
      cursor: default;
      background-color: #337ab7;
      border-color: #337ab7;
    }

    .page-bar i {
      font-style: normal;
      color: #d44950;
      margin: 0px 4px;
      font-size: 12px;
    }
  </style>
</head>

<body>
  <div id="app">
    <div class="x-nav">
      <span class="layui-breadcrumb">
        <a href="">桌面</a>
        <a href="">用户管理</a>
        <a>
          <cite>用户列表</cite></a>
      </span>
      <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right"
        onclick="location.reload()" title="刷新">
        <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i></a>
    </div>
    <div class="layui-fluid">
      <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
          <div class="layui-card">
            <div class="layui-card-body ">
              <form class="layui-form layui-col-space5">

                <div class="layui-inline layui-show-xs-block">
                  <input type="text" name="username" placeholder="请输入用户名" autocomplete="off" class="layui-input"
                    v-model="bankUser.userName">
                </div>

                <div class="layui-inline layui-show-xs-block">
                  <input type="text" name="idcard" placeholder="请输入身份证号" autocomplete="off" class="layui-input"
                    v-model="bankUser.idCard">
                </div>
                <div class="layui-inline layui-show-xs-block">
                  <button class="layui-btn" lay-submit="" lay-filter="sreach" @click.prevent="getBankUserList()"><i
                      class="layui-icon">&#xe615;</i></button>
                </div>
              </form>
            </div>
            <div class="layui-card-header">

            </div>
            <div class="layui-card-body layui-table-body layui-table-main">
              <table class="layui-table layui-form">
                <thead>
                  <tr>

                    <th>ID</th>
                    <th>用户名</th>
                    <th>手机</th>
                    <th>身份证号</th>
                    <th>创建时间</th>
                    <th>状态</th>
                    <th>操作</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="user in bankUsers">
                    <td>{{user.userId}}</td>
                    <td>{{user.userName}}</td>
                    <td>{{user.userPhone}}</td>
                    <td>{{user.idCard}}</td>
                    <td>{{user.gmtCreate}}</td>
                    <td class="td-status" v-if="user.userStatus == 0">
                      <span class="layui-btn layui-btn-normal layui-btn-mini ">已启用</span></td>
                    <td class="td-manage" v-if="user.userStatus == 0">
                      <span @click="memberStop(user.userId)" href="javascript:;" title="启用">
                        <i class="layui-icon">&#xe601;</i>
                      </span>
                    </td>
                    <td class="td-status" v-if="user.userStatus == 1">
                      <span class="layui-btn layui-btn-normal layui-btn-mini layui-btn-disabled">已停用</span></td>
                    <td class="td-manage" v-if="user.userStatus == 1">
                      <span @click="memberStart(user.userId)" href="javascript:;" title="停用">
                        <i class="layui-icon">&#xe62f</i>
                      </span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="layui-card-body ">
              <div class="page-bar">
                <ul>
                  <li v-if=" bankUser.pageNum>1"><a v-on:click=" bankUser.pageNum--,pageClick()">上一页</a>
                  </li>
                  <li v-if=" bankUser.pageNum==1"><a class="banclick">上一页</a></li>
                  <li v-for="index in indexs" v-bind:class="{ 'active':  bankUser.pageNum == index}">
                    <a v-on:click="btnClick(index)">{{ index }}</a>
                  </li>
                  <li v-if="bankUser.pageNum!= totalPageNum"><a v-on:click=" bankUser.pageNum++,pageClick()">下一页</a>
                  </li>
                  <li v-if="bankUser.pageNum == totalPageNum"><a class="banclick">下一页</a></li>
                  <li><a>共<i>{{this.totalPageNum}}</i>页</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

<script src="js/vuejs-2.5.16.js"></script>
<script src="js/axios-0.18.0.js"></script>
<script src="js/mock-min.js"></script>
<script src="js/api.js"></script>
<script src="components/top.js"></script>
<script src="components/search.js"></script>
<script>
  new Vue({
    el: "#app",
    data: {
      bankUsers: [],
      bankUser: {
        userName: "",
        idCard: "",
        pageNum: 1
      },
      status: "启用",
      totalPageNum: 0, //总页数
    },
    methods: {
      //查询所有
      getBankUserList: function () {
        getBankUserList(this.bankUser).then(res => {
          if (res.data.data.errno == 0) {
            this.bankUsers = res.data.data.data;
            console.log(this.bankUsers)
            this.totalPageNum = res.data.data.totalPageNum

          }
        })
      },
      btnClick: function (data) {//页码点击事件
        if (data != this.bankUser.pageNum) {
          this.bankUser.pageNum = data;
          this.getBankUserList();
        }


      },
      pageClick: function () {
        console.log('现在在' + this.bankUser.pageNum + '页');
        this.getBankUserList();
      },
      //启用
      memberStart: function (id) {
        memberStart(id).then(res => {
          if (res.data.data.errno == 0) {
            layer.msg('已启用!', { icon: 6, time: 1000 });
            this.getBankUserList();
          }
        })
      },
      //停用
      memberStop: function (id) {

        memberStop(id).then(res => {
          if (res.data.data.errno == 0) {
            layer.msg('已停用!', { icon: 5, time: 1000 });
            this.getBankUserList();
          }
        })

      }

    },
    created() {
      var url = window.location.search; //获取url中"?"符后的字串   
      var theRequest = new Object();
      if (url.indexOf("?") != -1) {
        var str = url.substr(1);
        strs = str.split("&");
        for (var i = 0; i < strs.length; i++) {
          //就是这句的问题
          theRequest[strs[i].split("=")[0]] = decodeURI(strs[i].split("=")[1]);
          //之前用了unescape()
          //才会出现乱码  
        }
      }
      this.bankUser.userName = theRequest['userName']
      this.bankUser.idCard = theRequest['idCard']
      console.log(this.bankUser)
      this.getBankUserList(this.bankUser);

    },
    computed: {
      indexs: function () {
        var left = 1;
        var right = this.totalPageNum;
        var ar = [];
        if (this.totalPageNum >= 5) {
          if (this.bankUser.pageNum > 3 && this.bankUser.pageNum < this.totalPageNum - 2) {
            left = this.bankUser.pageNum - 2
            right = this.bankUser.pageNum + 2
          } else {
            if (this.bankUser.pageNum <= 3) {
              left = 1
              right = 5
            } else {
              right = this.totalPageNum
              left = this.totalPageNum - 4
            }
          }
        }
        while (left <= right) {
          ar.push(left)
          left++
        }
        return ar
      }

    }
  })
</script>
<script>
  layui.use(['laydate', 'form'], function () {
    var laydate = layui.laydate;
    var form = layui.form;


    // 监听全选
    form.on('checkbox(checkall)', function (data) {

      if (data.elem.checked) {
        $('tbody input').prop('checked', true);
      } else {
        $('tbody input').prop('checked', false);
      }
      form.render('checkbox');
    });

    //执行一个laydate实例
    laydate.render({
      elem: '#start' //指定元素
    });

    //执行一个laydate实例
    laydate.render({
      elem: '#end' //指定元素
    });


  });

  /*用户-删除*/
  function member_del(obj, id) {
    layer.confirm('确认要删除吗？', function (index) {
      //发异步删除数据
      $(obj).parents("tr").remove();
      layer.msg('已删除!', { icon: 1, time: 1000 });
    });
  }



  function delAll(argument) {
    var ids = [];

    // 获取选中的id 
    $('tbody input').each(function (index, el) {
      if ($(this).prop('checked')) {
        ids.push($(this).val())
      }
    });

    layer.confirm('确认要删除吗？' + ids.toString(), function (index) {
      //捉到所有被选中的，发异步进行删除
      layer.msg('删除成功', { icon: 1 });
      $(".layui-form-checked").not('.header').parents('tr').remove();
    });
  }
</script>

</html>